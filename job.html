
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Lancement de tâches de calcul sur les serveurs &#8212; Documentation IQ-Plateforme-CHP </title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/translations.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Tâches de calcul en Python" href="python.html" />
    <link rel="prev" title="Connection à la plateforme" href="mise_en_route.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="python.html" title="Tâches de calcul en Python"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="mise_en_route.html" title="Connection à la plateforme"
             accesskey="P">précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation IQ-Plateforme-CHP </a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lancement de tâches de calcul sur les serveurs</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="lancement-de-taches-de-calcul-sur-les-serveurs">
<h1>Lancement de tâches de calcul sur les serveurs<a class="headerlink" href="#lancement-de-taches-de-calcul-sur-les-serveurs" title="Lien permanent vers cette rubrique">¶</a></h1>
<p>Cette page est un complément d’information de la page de l’Alliance dédiée: <a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs/fr">Exécuter des tâches</a>.</p>
<p>Les serveurs de calcul peuvent être utilisés de deux manières différentes qui correspondent à deux types de tâches distinctes:</p>
<ul class="simple">
<li><p>Les tâches dites interactives où les usagers sont redirigées sur les noeuds de calcul.</p></li>
<li><p>Les tâches dites en batch où l’usager soumet la tâche à un ordonnanceur qui est responsable de l’exécution de la tâche sur les noeuds de calcul.</p></li>
</ul>
<p>Dans tout les cas, il est interdit de lancer des tâches sur les noeuds de connexion.
En plus de pénaliser les autres utilisateurs qui font de la gestion de fichiers, ces noeuds ne disposent pas des derniers logiciels disponibles dans la pile de l’Alliance et offrent de mauvaises performances.</p>
<section id="taches-interactives">
<span id="id1"></span><h2>Tâches interactives<a class="headerlink" href="#taches-interactives" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Les tâches interactives sont des tâches généralement courtes (moins de 4 heures) qui requiert l’action soutenue de l’usager, comme la réalisation de tests, l’exploration de données, le débogage ou la compilation de codes.
La commande <code class="docutils literal notranslate"><span class="pre">salloc</span></code> suivie de l’option <code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">c-iq</span></code> permet d’être redirigé sur un noeuds de calcul de l’IQ avec 1 CPU et 8 Go de mémoire vive:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>salloc -p c-iq -t <span class="o">[</span>HH<span class="o">]</span>::<span class="o">[</span>mm<span class="o">]</span>:<span class="o">[</span>ss<span class="o">]</span> --mem<span class="o">=</span>8G --cpu-per-task<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
<p>À l’arrivé sur les serveurs de calcul, il est recommandé de charger de suite l’environnement standard le plus récent:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>module load StdEnv/2020
</pre></div>
</div>
</section>
<section id="taches-en-batch">
<h2>Tâches en batch<a class="headerlink" href="#taches-en-batch" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Les tâches en batch désignent toutes tâches qui ne nécessite pas l’action de l’usager (lancement d’un script Python par exemple).
Elle doit être la façon priviligié d’utiliser les serveurs de calcul car elle maximise leur l’efficacité.
Les scripts bash pour le lancement des tâches est exactement similaire aux scripts sur les autres grappes nationales de l’Alliance (voir la page <a class="reference external" href="https://docs.alliancecan.ca/wiki/Running_jobs/fr">Exécuter des tâches</a>), à la seule différence qu’il est nécessaire de charger l’environnement standard <code class="docutils literal notranslate"><span class="pre">StdEnv/2020</span></code> dans le script.
La soumission se fait ensuite en précisant la partition des noeuds de l’IQ à l’ordonnanceur:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch -p c-iq job.sh
</pre></div>
</div>
</section>
<section id="calcul-sur-gpu">
<h2>Calcul sur GPU<a class="headerlink" href="#calcul-sur-gpu" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Les tâches de calcul faisans l’utilisation de GPU ne sont pas différente des tâches CPU et peuvent être de type interactive ou en batch.</p>
<p>Au contraire des grappes nationales, les GPU ne sont pas connus de l’ordonnanceur et il faut donc spécifier explicitement le nom du serveur GPU (<code class="docutils literal notranslate"><span class="pre">cp3705</span></code>) de l’IQ à ce dernier avec l’option <code class="docutils literal notranslate"><span class="pre">--nodelist=cp3705</span></code>.</p>
<p>Par exemple, pour soumettre une tâches interactive avec accès aux GPU, la commande est la suivante:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>salloc -p c-iq -t <span class="o">[</span>HH<span class="o">]</span>::<span class="o">[</span>mm<span class="o">]</span>:<span class="o">[</span>ss<span class="o">]</span> --mem<span class="o">=</span>8G --cpu-per-task<span class="o">=</span><span class="m">1</span> --nodelist<span class="o">=</span>cp3705
</pre></div>
</div>
<p>L’activité du GPU peut être suivi avec une tâches interactive sur le noeud GPU et avec la commande <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>.
Cette dernière montre alors la mémoire GPU utilisé ainsi que la charge du processeur pour chacun des deux GPU du serveur <code class="docutils literal notranslate"><span class="pre">cp3705</span></code>.</p>
<p>En revanche, comme les GPUs ne sont pas connus de l’ordonnanceur, il peut parfois être nécessaire de spécifier aux programmes exécutés quel GPU utiliser.
Par exemple, lors de l’entrainement de réseau de neuronne avec PyTorch, la méthode <code class="docutils literal notranslate"><span class="pre">.to(device)</span></code> permettant de spécifier quel processeur utilisé (CPU ou GPU) peut être appelé soit avec <code class="docutils literal notranslate"><span class="pre">device='cpu'</span></code>, pour le CPU, <code class="docutils literal notranslate"><span class="pre">device='cuda'</span></code> pour un GPU, <code class="docutils literal notranslate"><span class="pre">device='cuda:0'</span></code> pour le GPU 0 ou <code class="docutils literal notranslate"><span class="pre">device='cuda:1'</span></code> pour le GPU 1 explicitement.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table des matières</a></h3>
    <ul>
<li><a class="reference internal" href="#">Lancement de tâches de calcul sur les serveurs</a><ul>
<li><a class="reference internal" href="#taches-interactives">Tâches interactives</a></li>
<li><a class="reference internal" href="#taches-en-batch">Tâches en batch</a></li>
<li><a class="reference internal" href="#calcul-sur-gpu">Calcul sur GPU</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Sujet précédent</h4>
    <p class="topless"><a href="mise_en_route.html"
                          title="Chapitre précédent">Connection à la plateforme</a></p>
  </div>
  <div>
    <h4>Sujet suivant</h4>
    <p class="topless"><a href="python.html"
                          title="Chapitre suivant">Tâches de calcul en Python</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/job.rst.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="Index général"
             >index</a></li>
        <li class="right" >
          <a href="python.html" title="Tâches de calcul en Python"
             >suivant</a> |</li>
        <li class="right" >
          <a href="mise_en_route.html" title="Connection à la plateforme"
             >précédent</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Documentation IQ-Plateforme-CHP </a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Lancement de tâches de calcul sur les serveurs</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Moise Rousseau.
      Créé en utilisant <a href="https://www.sphinx-doc.org/">Sphinx</a> 5.1.1.
    </div>
  </body>
</html>